/*
* sliderControl
*
*     touch slider input control for mobile WebKit
*     (also works on desktop webkit browsers for testing/dev purposes)
*
* Copyright (c) 2011
* http://42at.com/lab/sliderControl
* Released under MIT license
*
* Version 0.3 - Last updated: 2013.08.01
*/
(function(){window.sliderControl=c;window.slideToAction=f;c.version=f.version="0.3";var g=false,d,e;function c(j,m,q){var o=this,i=q||{},k=arguments.length;this.valuesFnc=null;if(m instanceof Array){this.values=m}else{if(k>4){i=arguments[4];this.values=b(arguments[1],arguments[2],arguments[3])}else{if(k==4){i=typeof arguments[3]=="object"?arguments[3]:null;this.values=b(arguments[1],arguments[2],i?1:arguments[3])}else{if(k==3){i=typeof arguments[2]=="object"?arguments[2]:null;if(i){if(typeof arguments[1]!="function"){this.values=b(1,arguments[1],1)}else{this.valuesFnc=arguments[1];this.values=b(0,100,1)}}else{this.values=b(arguments[1],arguments[2],1)}}else{if(k==2){i=typeof arguments[1]=="object"?arguments[1]:null;if(i||typeof arguments[1]=="function"){this.values=b(0,100,1)}else{if(typeof arguments[1]!="function"){this.values=b(1,arguments[1],1)}else{this.valuesFnc=arguments[1]}}}else{this.values=b(0,100,1)}}}}}this.options=i||{};for(var n in c.options.defaults){if(this.options[n]===undefined){this.options[n]=c.options.defaults[n]}}if(this.options.hints&&typeof this.options.hints=="string"){this.options.hints=this.options.hints.split("|")}this.wrapper=document.querySelector(j);this.thumb=null;this.$value=document.querySelector(this.options.valueSelector);this.labelsDiv=null;this.valueIndex=0;this.startIndex=-1;this.moving=false;this.value=this.values?this.values[this.valueIndex]:null;this.percent=0;if(!this.thumb){var h=document.createElement("div");h.className=this.options.thumbClass;this.thumb=this.wrapper.appendChild(h)}this.wrapper.className+=" "+this.options.sliderClass;for(var p in this.options.sliderCss){this.wrapper.style[p]=this.options.sliderCss[p]}for(var p in this.options.thumbCss){this.thumb.style[p]=this.options.thumbCss[p]}this.thumb.webkitTransitionProperty="-webkit-transform";this.thumb.style.webkitTransitionTimingFunction=this.options.easing;this.thumb.style.webkitTransform="translate3d(0, 0, 0)";this.thumb.addEventListener("touchstart",this,true);this.thumb.addEventListener("mousedown",this,true);this.numberOfTouches=1;if(this.options.labels){a(this)}if(this.options.slideToClick||this.options.enableToggle){this.wrapper.addEventListener("click",this,true)}if(typeof window.orientation!="undefined"){document.body.addEventListener("orientationchange",this,true)}this.refresh();if(typeof this.options.initialValue!="undefined"){if(this.options.initialValue!==null){this.valueIndex=-1;this.setValue(this.options.initialValue)}}else{this.setIndex(0)}if(this.options.disabled){this.disable()}}c.options={defaults:{easing:"ease-out",easingDuration:150,labels:false,slideToClick:true,enableSnap:true,enableToggle:false,hints:null,disabled:false,valueSelector:".sliderValue",sliderClass:"slider",thumbClass:"sliderThumb",labelClass:"sliderLabel",selectedClass:"selected",labelsDivClass:"sliderLabelsDiv",disabledClass:"sliderDisabled",sliderCss:{},thumbCss:{},labelWidthAdjust:1,onslidebegin:null,onslide:null,onslideend:null,onchange:null,onclick:null,dummy:null}};c.prototype={slide:function(i,h){if(typeof this.options.onslide=="function"){return this.options.onslide.apply(this,arguments)}if(h&&this.$value){this.$value.innerHTML=this.options.hints?this.options.hints[this.valueIndex]:this.value}},change:function(){if(typeof this.options.onchange=="function"){return this.options.onchange.apply(this,arguments)}},slideend:function(){if(typeof this.options.onslideend=="function"){return this.options.onslideend.apply(this,arguments)}},slidebegin:function(){if(typeof this.options.onslidebegin=="function"){return this.options.onslidebegin.apply(this,arguments)}},click:function(){if(typeof this.options.onclick=="function"){return this.options.onclick.apply(this,arguments)}return true},getValue:function(){return this.value},getIndex:function(){return this.valueIndex},setValue:function(i){if(typeof i!="undefined"&&this.values){for(var h in this.values){if(i==this.values[h]){this.setIndex(h);break}}}return this.value},setIndex:function(j){if(typeof j!="undefined"&&this.values&&j>=0&&j<this.values.length){var k=this.percentAtIndex(j),l=Math.floor(this.maxSlide*k/100);if(j!=this.valueIndex){var h=this.position();this.valueIndex=j>>0;this.value=this.values[j];this.triggerCallback("slide",l-h,true);this.change()}this.slideTo(k)}return this.valueIndex},toggle:function(){var h=this.valueIndex;if(h<this.values.length-1){h++}else{h=0}this.setIndex(h);return this.value},next:function(k){k=typeof k=="undefined"?1:k;var j=this.valueIndex,h=this.values.length-1;if(j+k>h||j+k<0){return null}this.setIndex(j+k);return this.value},prev:function(h){h=typeof h=="undefined"?1:h;return this.next(-h)},first:function(){this.setIndex(0);return this.value},last:function(){this.setIndex(this.values.length-1);return this.value},disable:function(){this.disabled=true;this.wrapper.className+=" "+this.options.disabledClass},enable:function(){this.disabled=false;this.wrapper.className=this.wrapper.className.replace(new RegExp("\\b"+this.options.disabledClass+"\\b","g"),"")},destroy:function(){this.destroyLabels();if(this.thumb){this.thumb.removeEventListener("touchstart",this,true);this.thumb.removeEventListener("mousedown",this,true);this.wrapper.removeChild(this.thumb);this.thumb=null}if(this.options.slideToClick||this.options.enableToggle){this.wrapper.removeEventListener("click",this,true)}if(typeof window.orientation!="undefined"){document.body.removeEventListener("orientationchange",this,true)}for(var h in this.options.sliderCss){this.wrapper.style[h]=""}if(this.$value){this.$value.innerHTML=""}this.wrapper=null;this.$value=null},percentAtIndex:function(h){if(!this.values){return 0}var k=this.values.length;var j=Math.floor(h*(100/(k-1||1)));return j},indexFromPos:function(j){if(!this.values){return 0}if(j<0){j=0}var k=this.values.length;var h=Math.round((k-1)*j/this.maxSlide);return h},triggerCallback:function(j){var i=this,h=[].slice.call(arguments);h.shift();setTimeout(function(){i[j].apply(i,h)},0)},handleEvent:function(h){if(this.disabled){return}if(g&&h.type.indexOf("mouse")==0){return}switch(h.type){case"touchstart":case"mousedown":g=h.type==="touchstart";this.onTouchStart(h);break;case"touchmove":case"mousemove":this.onTouchMove(h);break;case"touchend":case"mouseup":this.onTouchEnd(h);break;case"click":if(!this.click(h)){return}if(!this.moving&&this.options.slideToClick&&h.target!=this.thumb){this.onClick(h)}else{if(this.options.enableToggle){this.toggleOnClick(h)}}this.moving=false;break;case"orientationchange":this.onOrientation(h);break;case"webkitTransitionEnd":this.onTransitionEnd(h);break}},position:function(h){if(typeof h!="undefined"){this._position=h;this.percent=Math.floor(h/this.maxSlide*100);this.thumb.style.webkitTransform="translate3d("+h+"px, 0, 0)"}return this._position},refresh:function(){this.thumb.style.webkitTransitionDuration="0";this.wrapperWidth=this.wrapper.clientWidth;this.maxSlide=this.wrapper.clientWidth-this.thumb.offsetWidth-parseInt(getComputedStyle(this.wrapper,null).getPropertyValue("padding-left"))-parseInt(getComputedStyle(this.wrapper,null).getPropertyValue("padding-right"))},onClick:function(k){var h=k.clientX;h-=this.wrapper.offsetLeft+this.thumb.offsetWidth/2;var j=this.indexFromPos(h);this.startIndex=this.valueIndex;if(j!=this.valueIndex){this.setIndex(j)}},toggleOnClick:function(h){if(this.moving||h.target!=this.thumb){return false}this.toggle()},destroyLabels:function(){if(!this.labelsDiv){return}var h=this.labelsDiv;while(h.firstChild){h.removeChild(h.firstChild)}h.parentNode.removeChild(h)},onOrientation:function(h){if(this.wrapperWidth!=this.wrapper.clientWidth){this.destroyLabels();a(this);this.setIndex(this.valueIndex)}else{this.refresh()}},onTouchStart:function(h){d=g?"touchmove":"mousemove",e=g?"touchend":"mouseup";if(h.targetTouches&&h.targetTouches.length!=this.numberOfTouches){return}this.moving=false;if(this.values){this.startIndex=this.valueIndex}this.startX=h.targetTouches?h.targetTouches[0].clientX:h.clientX;this.thumb.addEventListener(d,this,false);this.thumb.addEventListener(e,this,false);this.triggerCallback("slidebegin");return false},onTouchMove:function(m){if(m.targetTouches&&m.targetTouches.length!=this.numberOfTouches){return}m.preventDefault();var h=m.targetTouches?m.targetTouches[0].clientX:m.clientX;var l=window.getComputedStyle(this.thumb,null).webkitTransform;l=new WebKitCSSMatrix(l).m41;var p=h-this.startX;if(p==0||(l<0&&p<0)||(l>this.maxSlide&&p>0)){return false}this.moving=true;var o=this.position(),k=Math.min(this.maxSlide,Math.max(o+p,0));this.position(k);this.startX=h;var n=true;if(this.values){var j=this.indexFromPos(k);if((n=j!=this.valueIndex)){this.value=this.valuesFnc?this.valuesFnc(j):this.values[j];this.valueIndex=j}}this.triggerCallback("slide",p,n);return false},onTouchEnd:function(l){this.thumb.removeEventListener(d,this,false);this.thumb.removeEventListener(e,this,false);var j=this;if(this.valueIndex!=this.startIndex||(this.values.length==1&&this.percent>99)){this.triggerCallback("change")}if(this.moving&&(!this.options.enableSnap||this.options.easingDuration==0)){this.triggerCallback("slideend")}if(!this.moving||!this.options.enableSnap){this.updateSelected()}else{var m=this.position();if(this.values){var h=this.indexFromPos(m);var k=this.percentAtIndex(h);this.slideTo(k)}}return false},onTransitionEnd:function(){this.thumb.style.webkitTransitionDuration="0";this.thumb.removeEventListener("webkitTransitionEnd",this,false);this.triggerCallback("slideend")},slideTo:function(h){this.thumb.style.webkitTransitionTimingFunction=this.options.easing;this.thumb.style.webkitTransitionDuration=this.options.easingDuration+"ms";this.thumb.addEventListener("webkitTransitionEnd",this,false);var i=Math.floor(this.maxSlide*h/100);this.position(i);this.updateSelected();return},updateSelected:function(){if(this.startIndex!=this.valueIndex&&this.options.selectedClass&&this.labelsDiv){var h=this.labelsDiv.querySelector("."+this.options.selectedClass);if(h){h.className=h.className.replace(new RegExp("\\b"+this.options.selectedClass+"\\b","g"),"")}if(this.labelsDiv.childNodes.length>this.valueIndex){this.labelsDiv.childNodes[this.valueIndex].className+=" "+this.options.selectedClass}}}};c.range=b;function b(p,i,m){var h=arguments.length;if(h==0){return[]}if(h==1){return arguments.callee(0,p,1)}if(h==2){return arguments.callee(p,i,1)}var j=[];if(m==0){return[]}if((p<=i&&m<0)||(p>=i&&m>0)){m=-m}var o=-1;var k=m.toString().indexOf(".");if(k!=-1){o=m.toString().length-(1+k);k=true}else{p>>=0;i>>=0;m>>=0;k=false}for(;m>0?p<=i:p>=i;p+=m){j.push(k?parseFloat(p.toFixed(o)):p)}return j}function a(i){var p=i.options.labels;switch(typeof p){case"boolean":case"number":p=i.values;break;case"string":p=p.split(/\|/);if(p.length!=i.values.length){p=new Array(i.values.length+1).join(p+"\u0000").split("\u0000",i.values.length)}break}if(!p.length){return}var o=document.createElement("div");o.className=i.options.labelsDivClass;i.labelsDiv=i.wrapper.appendChild(o);var l="",m=i.values.length>1?i.values.length:p.length,h=Math.floor(i.wrapper.clientWidth/i.values.length)-i.options.labelWidthAdjust;if(i.values.length>1){i.thumb.style.width=h+"px"}i.refresh();for(var k in p){l+='<span class="'+i.options.labelClass+'" style="width:'+h+'px;">'+p[k]+"</span>"}i.labelsDiv.innerHTML=l}function f(l,n,k){var h={labels:true,selectedClass:"",sliderClass:"sliderAction",thumbCss:{width:"60px"},onslide:function(o){var i=this.labelsDiv;i.style.webkitTransitionProperty="opacity";i.style.webkitTransitionDuration="50ms";i.style.opacity=Math.max(0,1-this.percent/50)},onchange:function(){alert("override onchange callback to do something semi-useful!")},onslideend:function(){var i=this.labelsDiv;i.style.opacity=1},thumbLabel:""};for(var j in k){h[j]=k[j]}var m=new c(l,[n],h);m.thumb.innerHTML=h.thumbLabel;return m}})();
